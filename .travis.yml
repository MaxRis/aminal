language: go
matrix:
  include:
  - os: linux
    dist: xenial
    go: 1.10.x
  - os: linux
    dist: xenial
    go: 1.11.x
  - os: linux
    dist: xenial
    go: master
  - os: osx
    go: 1.10.x
  - os: osx
    go: 1.11.x
  - os: osx
    go: master
  allow_failures:
  - go: master
  fast_finish: true
go_import_path: github.com/liamg/aminal
before_install:
- if [[ $TRAVIS_OS_NAME == 'linux' ]]; then sudo apt-get install -y xorg-dev libgl1-mesa-dev
  gcc-multilib gcc-mingw-w64-x86-64 xvfb vttest && go get github.com/mitchellh/gox;
  fi
script:
- go get
- if [[ $TRAVIS_OS_NAME == 'linux' ]]; then xvfb-run --server-args="-screen 0 1024x768x24"
  make test; else make test; fi
- if [[ $TRAVIS_OS_NAME == 'osx' ]]; then make build-darwin-native-travis; fi
- if [[ $TRAVIS_OS_NAME == 'linux' ]]; then make build-linux-travis; fi
- if [[ $TRAVIS_OS_NAME == 'linux' ]]; then make windows-cross-compile-travis; fi
env:
  global:
  - secure: m5q2Ac42MTd7h/watEeyxTTWS40DXzAbz/8tFFYYUbbiSD0fSZA9pP5KZU8/cXx7Q0DkUGs+yLuClDXQrQSbgHc89+O15Yw9RZfNMSXF0L7w5VdxGt4Cr+AdTb2ypnc6Mm05X/MCWtTdWl0fZMWDWhYWO8iylBLMd1fQfoZqBbG2g6p8ZEiz8cFAb2neJXZCvgfQqGuI0dpL2q2FTsQnidAkAs3ZGDDLMUMFyGD+lX+3bVymNaKvYaFmtqbSjy9K5kNB5K0yX7j2HZUxdqVJvKlVc9d62spaISRA+E5eglN04xSmVGxBQpkAsl0OxrygKr+BZApV23sZzmgvKCc63KCYFgN35pyXRS16hK+ZBlYWKmlAGpR0zxRhDsnnQqKkwnGMXErWhrsBC6172Pwrc/Vsl154DjmobHuy2yeEAZYQm4fbOjaeX83m2dmdXm3xjUek01E74jseREpviRK5y2pYznPLGNO0zLkC/JuQhSVjE/TIkSSZkY7HIBH4HAtaQyBX6NJdbWp28HxoEj7vv5l59j5QT58io1+VC6uNg/EFWl15kQJcdRc2nXTSVccPtRRtzUT+mIsQTujf2xvHnLgt5Oe04yY3EUxYifvDhaeyCMCJeZ2vtXX3D1Ic5GZav8ZbCy+5+ey63IukIQgfZJoIb5svl+n9s/KYMmif1EY=
before_deploy:
  - export CHANGELOG=$(git log $(git describe --abbrev=0 --tags "${TRAVIS_TAG}^")..$TRAVIS_TAG --pretty=format:'<li> <a href="http://github.com/liamg/aminal/commit/%H">view commit &bull;</a> %s</li> ' --reverse | while read line; do echo -n "$line "; done)
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: VhtCoyt+Un22uwkVX2CS6sS1TOc7e/AsJLHt5b3KZuTTbjegJxMc65COOSun8BIlAjtK/we03xs0wEZQE6GRHoSzM/bDVz761FZHNDT1Y5FNq9jyaBTHiZBELPkVFcino2tFBbux7BSspYL/RxQYfSRd8VKe/voIe1j1PzC9pj3o4NlfvX5r1wn6Ttbb3sC9rlagjTcMar+FX5j1GmCUhBgUE4CbMwoDXyjY77Iu07JxkoRLSfdtE+nbtUJjQ+kA6G1BfNpoa+xXnVZzZhuSkLwgrJZtBKuY1cYVGtXrjZlsPvYTMxaK081O2sVtirSW0dSBr7h6q0+cN4cNX7+d5zIVtmZbwVRRGdcRUOJS32yrBu/Xkwe8X5H9dy798IkzZyQLuZ7X97xFfPDoaZ3RCVImd8ST8hPtKEgN5S+JO4hqqVO0Osaf0YiqYz7tU/CaLBYgHdpWcIzKavp5yenfGWwGmLgvn8m8LKw047eAG1wQNf7VV/eHd2NrUHvNE8r4ZATUlGT07r6CtLU7S6xtB7qsKsIdOkHsaq9U04YpFmjeqKrRhUrUSyBs6WpKEYadhE/oKC7slr9AXNPDVX1Z4oqH2MCZqY9NeHsT7ESSDtw+BXHfxWRyUiFD2cpqwzy/LOArhfZzqmrkb+HxZzCwiIkO0Xg85aMtNOsNPYCHVLc=
  name: "Aminal $TRAVIS_TAG"
  body: ${CHANGELOG}
  file:
    - bin/darwin/aminal-darwin-amd64
    - bin/linux/aminal-linux-amd64
    - bin/windows/aminal-windows-amd64.exe
  on:
    repo: MaxRis/aminal
    tags: true
    condition: "$TRAVIS_GO_VERSION =~ ^1\\.11"
